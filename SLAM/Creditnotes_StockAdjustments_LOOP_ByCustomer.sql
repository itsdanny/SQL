USE demo

CREATE TABLE #CreditNotes (CRTEXT NVARCHAR(2000))
CREATE TABLE #StockAdjusts (CRTEXT NVARCHAR(2000))
DECLARE @DataHeader TABLE (Id INT IDENTITY(1,1), DATASTRING VARCHAR(MAX))
DECLARE @Row INT = 1, @Rows INT, @LineInFile INT = 1
DECLARE @CurOrder VARCHAR(20) , @NextOrder VARCHAR(20), @FileRow INT = 1
DECLARE @res  TABLE(Id INT IDENTITY(1,1), SageRef varchar(10), ProductCode VARCHAR(20), Quantity VARCHAR(4), CreditAmount FLOAT, defDate VARCHAR(8), OrderLines INT)
DECLARE @orderno VARCHAR(20)
DECLARE @customer VARCHAR(3)
DECLARE @NextCNNumber INT
DECLARE @Orders TABLE(Id INT IDENTITY(1,1),  customer VARCHAR(3))

INSERT INTO @Orders
SELECT		DISTINCT   customer
FROM		demo.scheme.opheadm h WITH(NOLOCK)
WHERE		h.invoice_no IN  ('OP/C015153','OP/C015154','OP/C015155','OP/C015156','OP/C015157','OP/C015158','OP/C015159','OP/C015160','OP/C015162','OP/C015163','OP/C015164','OP/C015165','OP/C015166','OP/C015167','OP/C015168','OP/C015169','OP/C015170','OP/C015171','OP/C015172','OP/C015173','OP/C015174','OP/C015175','OP/C015176','OP/C015177','OP/C015178','OP/C015179','OP/C015180','OP/C015184','OP/C015187','OP/C015190','OP/C015191','OP/C015193','OP/C015195','OP/C015196','OP/C015198','OP/C015201','OP/C015205','OP/C015216','OP/C015217','OP/C015218','OP/C015219','OP/C015220','OP/C015222','OP/C015223','OP/C015224','OP/C015225','OP/C015226','OP/C015227','OP/C015230','OP/C015231','OP/C015232','OP/C015233','OP/C015235','OP/C015236','OP/C015238','OP/C015239','OP/C015240','OP/C015241','OP/C015242','OP/C015243','OP/C015245','OP/C015246','OP/C015248','OP/C015250','OP/C015251','OP/C015253','OP/C015254','OP/C015255','OP/C015257','OP/C015260','OP/C015263','OP/C015264','OP/C015265','OP/C015268','OP/C015269','OP/C015270','OP/C015271','OP/C015272','OP/C015273','OP/C015274','OP/C015275','OP/C015276','OP/C015277','OP/C015278','OP/C015279','OP/C015280','OP/C015281','OP/C015282','OP/C015283','OP/C015284','OP/C015285','OP/C015286','OP/C015287','OP/C015288','OP/C015289','OP/C015290','OP/C015291','OP/C015292','OP/C015293','OP/C015294','OP/C015295','OP/C015296','OP/C015297','OP/C015298','OP/C015299','OP/C015300','OP/C015303','OP/C015304','OP/C015305','OP/C015306','OP/C015307','OP/C015308','OP/C015309','OP/C015310','OP/C015311','OP/C015312','OP/C015313','OP/C015314','OP/C015315','OP/C015316','OP/C015317','OP/C015318','OP/C015319','OP/C015320','OP/C015321','OP/C015322','OP/C015323','OP/C015324','OP/C015325','OP/C015326','OP/C015327','OP/C015328','OP/C015329','OP/C015330','OP/C015331','OP/C015332','OP/C015333','OP/C015334','OP/C015335','OP/C015336','OP/C015337','OP/C015338','OP/C015340','OP/C015341','OP/C015342','OP/C015343','OP/C015344','OP/C015345','OP/C015346','OP/C015347','OP/C015348','OP/C015349','OP/C015350','OP/C015351','OP/C015352','OP/C015353','OP/C015354','OP/C015355','OP/C015356','OP/C015357','OP/C015358','OP/C015359','OP/C015360','OP/C015361','OP/C015362','OP/C015363','OP/C015364','OP/C015367','OP/C015368','OP/C015369','OP/C015370','OP/C015371','OP/C015372','OP/C015373','OP/C015374','OP/C015375','OP/C015376','OP/C015377','OP/C015378','OP/C015379','OP/C015380','OP/C015381','OP/C015382','OP/C015383','OP/C015384','OP/C015385','OP/C015386','OP/C015387','OP/C015388','OP/C015389','OP/C015390','OP/C015391','OP/C015392','OP/C015393','OP/C015394','OP/C015395','OP/C015396','OP/C015397','OP/C015398','OP/C015399','OP/C015400','OP/C015401','OP/C015402','OP/C015404','OP/C015405','OP/C015406','OP/C015407','OP/C015408','OP/C015410','OP/C015411','OP/C015412','OP/C015415','OP/C015416','OP/C015417','OP/C015419','OP/C015421','OP/C015422','OP/C015424','OP/C015425','OP/C015426','OP/C015428','OP/C015431','OP/C015432','OP/C015433','OP/C015434','OP/C015435','OP/C015436','OP/C015437','OP/C015438','OP/C015440','OP/C015441','OP/C015442','OP/C015443','OP/C015445','OP/C015446','OP/C015447','OP/C015448','OP/C015449','OP/C015450','OP/C015451','OP/C015452','OP/C015453','OP/C015454','OP/C015455','OP/C015457','OP/C015458','OP/C015459','OP/C015460','OP/C015461','OP/C015462','OP/C015463','OP/C015465','OP/C015466','OP/C015468','OP/C015469','OP/C015470','OP/C015471','OP/C015473','OP/C015474','OP/C015475','OP/C015476','OP/C015477','OP/C015478','OP/C015479','OP/C015480','OP/C015481','OP/C015482','OP/C015483','OP/C015484','OP/C015507','OP/C015508','OP/C015509','OP/C015511','OP/C015512','OP/C015513','OP/C015514','OP/C015515','OP/C015516','OP/C015517','OP/C015518','OP/C015519','OP/C015520','OP/C015522','OP/C015523','OP/C015525','OP/C015528','OP/C015529','OP/C015530','OP/C015531','OP/C015532','OP/C015533','OP/C015534','OP/C015535','OP/C015536','OP/C015537','OP/C015538','OP/C015540','OP/C015541','OP/C015542','OP/C015546','OP/C015548','OP/C015549','OP/C015550','OP/C015551','OP/C015553','OP/C015554','OP/C015555','OP/C015556','OP/C015557','OP/C015558','OP/C015559','OP/C015560','OP/C015561','OP/C015562','OP/C015563','OP/C015564','OP/C015565','OP/C015566','OP/C015567','OP/C015569','OP/C015570','OP/C015571','OP/C015572','OP/C015573','OP/C015574','OP/C015575','OP/C015576','OP/C015578','OP/C015579','OP/C015580','OP/C015581','OP/C015582','OP/C015584','OP/C015585','OP/C015586','OP/C015588','OP/C015589','OP/C015590','OP/C015591','OP/C015592','OP/C015593','OP/C015594','OP/C015595','OP/C015596','OP/C015598','OP/C015599','OP/C015600','OP/C015601','OP/C015602','OP/C015603','OP/C015604','OP/C015605','OP/C015606','OP/C015608','OP/C015609','OP/C015611','OP/C015612','OP/C015613','OP/C015614','OP/C015615','OP/C015617','OP/C015618','OP/C015619','OP/C015620','OP/C015621','OP/C015622','OP/C015623','OP/C015624','OP/C015625','OP/C015626','OP/C015629','OP/C015630','OP/C015631','OP/C015632','OP/C015633','OP/C015634','OP/C015635','OP/C015637','OP/C015638','OP/C015639','OP/C015640','OP/C015641','OP/C015642','OP/C015644','OP/C015645','OP/C015649','OP/C015650','OP/C015651','OP/C015652','OP/C015653','OP/C015654','OP/C015655','OP/C015657','OP/C015658','OP/C015659','OP/C015660','OP/C015661','OP/C015662','OP/C015663','OP/C015664','OP/C015666','OP/C015667','OP/C015668','OP/C015669','OP/C015671','OP/C015672','OP/C015673','OP/C015674','OP/C015676','OP/C015677','OP/C015678','OP/C015679','OP/C015680','OP/C015681','OP/C015683','OP/C015684','OP/C015685','OP/C015686','OP/C015687','OP/C015688','OP/C015689','OP/C015690','OP/C015691','OP/C015692','OP/C015693','OP/C015694','OP/C015695','OP/C015697','OP/C015698','OP/C015699','OP/C015700','OP/C015701','OP/C015702','OP/C015703','OP/C015705','OP/C015706','OP/C015708','OP/C015709','OP/C015710','OP/C015711','OP/C015712','OP/C015713','OP/C015714','OP/C015715','OP/C015716','OP/C015717','OP/C015718','OP/C015719','OP/C015720','OP/C015722','OP/C015723','OP/C015724','OP/C015725','OP/C015726','OP/C015727','OP/C015728','OP/C015729','OP/C015730','OP/C015731','OP/C015732','OP/C015733','OP/C015735','OP/C015736','OP/C015737','OP/C015738','OP/C015742','OP/C015743','OP/C015744','OP/C015745','OP/C015746','OP/C015747','OP/C015748','OP/C015749','OP/C015750','OP/C015751','OP/C015752','OP/C015753','OP/C015754','OP/C015755','OP/C015756','OP/C015758','OP/C015759','OP/C015764','OP/C015765','OP/C015767','OP/C015768','OP/C015769','OP/C015770','OP/C015771','OP/C015772','OP/C015773','OP/C015774','OP/C015775','OP/C015776','OP/C015777','OP/C015778','OP/C015779','OP/C015780','OP/C015781','OP/C015783','OP/C015784','OP/C015785','OP/C015786','OP/C015787','OP/C015788','OP/C015789','OP/C015790','OP/C015791','OP/C015792','OP/C015793','OP/C015794','OP/C015795','OP/C015796','OP/C015797','OP/C015798','OP/C015799','OP/C015801','OP/C015802','OP/C015803','OP/C015805','OP/C015806','OP/C015807','OP/C015808','OP/C015809','OP/C015810','OP/C015812','OP/C015813','OP/C015814','OP/C015815','OP/C015816','OP/C015818','OP/C015819','OP/C015820','OP/C015821','OP/C015822','OP/C015823','OP/C015824','OP/C015825','OP/C015827','OP/C015828','OP/C015830','OP/C015831','OP/C015832','OP/C015834','OP/C015835','OP/C015836','OP/C015838','OP/C015840','OP/C015841','OP/C015842','OP/C015843','OP/C015844','OP/C015845','OP/C015846','OP/C015847','OP/C015848','OP/C015849','OP/C015850','OP/C015851','OP/C015852','OP/C015853','OP/C015854','OP/C015855','OP/C015856','OP/C015857','OP/C015858','OP/C015859','OP/C015860','OP/C015861','OP/C015862','OP/C015863','OP/C015864','OP/C015865','OP/C015866','OP/C015867','OP/C015868','OP/C015869','OP/C015870','OP/C015871','OP/C015873','OP/C015874','OP/C015875','OP/C015876','OP/C015877','OP/C015878','OP/C015879','OP/C015880','OP/C015881','OP/C015882','OP/C015883','OP/C015884','OP/C015885','OP/C015886','OP/C015887','OP/C015888','OP/C015890','OP/C015891','OP/C015892','OP/C015893','OP/C015894','OP/C015895','OP/C015896','OP/C015897','OP/C015898','OP/C015899','OP/C015900','OP/C015901','OP/C015902','OP/C015904','OP/C015905','OP/C015906','OP/C015907','OP/C015908','OP/C015909','OP/C015910','OP/C015911','OP/C015912','OP/C015913','OP/C015914','OP/C015915','OP/C015916','OP/C015917','OP/C015918','OP/C015919','OP/C015920','OP/C015921','OP/C015922','OP/C015923','OP/C015924','OP/C015925','OP/C015926','OP/C015928','OP/C015929','OP/C015930','OP/C015931','OP/C015932','OP/C015933','OP/C015934','OP/C015935','OP/C015936','OP/C015937','OP/C015938','OP/C015939','OP/C015940','OP/C015941','OP/C015942','OP/C015943','OP/C015945','OP/C015946','OP/C015947','OP/C015948','OP/C015949','OP/C015950','OP/C015951','OP/C015952','OP/C015953','OP/C015954','OP/C015955','OP/C015956','OP/C015957','OP/C015958','OP/C015959','OP/C015961','OP/C015962','OP/C015963','OP/C015964','OP/C015965','OP/C015966','OP/C015967','OP/C015969','OP/C015970','OP/C015971','OP/C015972','OP/C015973','OP/C015974','OP/C015975','OP/C015976','OP/C015977','OP/C015978','OP/C015979','OP/C015980','OP/C015981','OP/C015982','OP/C015983','OP/C015984','OP/C015985','OP/C015986','OP/C015987','OP/C015988','OP/C015989','OP/C015990','OP/C015991','OP/C015992','OP/C015993','OP/C015994','OP/C015995','OP/C015996','OP/C015997','OP/C015998','OP/C015999','OP/C016000','OP/C016001','OP/C016002','OP/C016004','OP/C016005','OP/C016006','OP/C016007','OP/C016008','OP/C016009','OP/C016010','OP/C016011','OP/C016012','OP/C016013','OP/C016014','OP/C016015','OP/C016016','OP/C016017','OP/C016018','OP/C016019','OP/C016021','OP/C016022','OP/C016023','OP/C016024','OP/C016025','OP/C016026','OP/C016027','OP/C016028','OP/C016029','OP/C016030','OP/C016031','OP/C016032','OP/C016033','OP/C016035','OP/C016036','OP/C016037','OP/C016038','OP/C016039','OP/C016040','OP/C016041','OP/C016042','OP/C016043','OP/C016044','OP/C016045','OP/C016046','OP/C016047','OP/C016048','OP/C016049','OP/C016050','OP/C016051','OP/C016052','OP/C016053','OP/C016054','OP/C016055','OP/C016056','OP/C016057','OP/C016059','OP/C016060','OP/C016061','OP/C016062','OP/C016063','OP/C016064','OP/C016065','OP/C016066','OP/C016067','OP/C016068','OP/C016069','OP/C016070','OP/C016071','OP/C016072','OP/C016073','OP/C016074','OP/C016076','OP/C016077','OP/C016078','OP/C016079','OP/C016080','OP/C016081','OP/C016082','OP/C016083','OP/C016084','OP/C016085','OP/C016086','OP/C016087','OP/C016088','OP/C016089','OP/C016090','OP/C016092','OP/C016093','OP/C016094','OP/C016095','OP/C016096','OP/C016097','OP/C016098','OP/C016100','OP/C016101','OP/C016102','OP/C016103','OP/C016104','OP/C016105','OP/C016106','OP/C016107','OP/C016108','OP/C016109','OP/C016110','OP/C016111','OP/C016112','OP/C016113','OP/C016114','OP/C016115','OP/C016116','OP/C016117','OP/C016118','OP/C016119','OP/C016120','OP/C016121','OP/C016122','OP/C016123','OP/C016124','OP/C016125','OP/C016126','OP/C016127','OP/C016128','OP/C016129','OP/C016130','OP/C016131','OP/C016132','OP/C016133','OP/C016135','OP/C016136','OP/C016137','OP/C016138','OP/C016139','OP/C016140','OP/C016141','OP/C016142','OP/C016143','OP/C016144','OP/C016145','OP/C016146','OP/C016147','OP/C016148','OP/C016149','OP/C016150','OP/C016152','OP/C016153','OP/C016154','OP/C016155','OP/C016156','OP/C016157','OP/C016158','OP/C016159','OP/C016160','OP/C016161','OP/C016162','OP/C016163','OP/C016164','OP/C016166','OP/C016167','OP/C016168','OP/C016169','OP/C016170','OP/C016171','OP/C016172','OP/C016173','OP/C016174','OP/C016175','OP/C016176','OP/C016177','OP/C016178','OP/C016179','OP/C016180','OP/C016181','OP/C016182','OP/C016183','OP/C016184','OP/C016185','OP/C016186','OP/C016187','OP/C016188','OP/C016190','OP/C016191','OP/C016192','OP/C016193','OP/C016194','OP/C016195','OP/C016196','OP/C016197','OP/C016198','OP/C016199','OP/C016200','OP/C016201','OP/C016202','OP/C016203','OP/C016204','OP/C016205','OP/C016207','OP/C016208','OP/C016209','OP/C016210','OP/C016211','OP/C016212','OP/C016213','OP/C016214','OP/C016215','OP/C016216','OP/C016217','OP/C016218','OP/C016219','OP/C016220','OP/C016221','OP/C016223','OP/C016224','OP/C016225','OP/C016226','OP/C016227','OP/C016228','OP/C016229','OP/C016231','OP/C016232','OP/C016233','OP/C016234','OP/C016235','OP/C016236','OP/C016237','OP/C016238','OP/C016239','OP/C016240','OP/C016241','OP/C016242','OP/C016243','OP/C016244','OP/C016245','OP/C016246','OP/C016247','OP/C016248','OP/C016249','OP/C016250','OP/C016251','OP/C016252','OP/C016253','OP/C016254','OP/C016255','OP/C016256','OP/C016257','OP/C016258','OP/C016259','OP/C016260','OP/C016261','OP/C016262','OP/C016263','OP/C016264','OP/C016266','OP/C016267','OP/C016268','OP/C016269','OP/C016270','OP/C016271','OP/C016272','OP/C016273','OP/C016274','OP/C016275','OP/C016276','OP/C016277','OP/C016278','OP/C016279','OP/C016280','OP/C016281','OP/C016283','OP/C016284','OP/C016285','OP/C016286','OP/C016287','OP/C016288','OP/C016289','OP/C016290','OP/C016291','OP/C016292','OP/C016293','OP/C016294','OP/C016295','OP/C016297','OP/C016298','OP/C016299','OP/C016300','OP/C016301','OP/C016302','OP/C016303','OP/C016304','OP/C016305','OP/C016306','OP/C016307','OP/C016308','OP/C016309','OP/C016310','OP/C016311','OP/C016312','OP/C016313','OP/C016314','OP/C016315','OP/C016316','OP/C016317','OP/C016318','OP/C016319','OP/C016321','OP/C016322','OP/C016323','OP/C016324','OP/C016325','OP/C016326','OP/C016327','OP/C016328','OP/C016329','OP/C016330','OP/C016331','OP/C016332','OP/C016333','OP/C016334','OP/C016335','OP/C016336','OP/C016338','OP/C016339','OP/C016340','OP/C016341','OP/C016342','OP/C016343','OP/C016344','OP/C016345','OP/C016346','OP/C016347','OP/C016348','OP/C016349','OP/C016350','OP/C016351','OP/C016352','OP/C016354','OP/C016355','OP/C016356','OP/C016357','OP/C016358','OP/C016359','OP/C016360','OP/C016362','OP/C016363','OP/C016364','OP/C016365','OP/C016366','OP/C016367','OP/C016368','OP/C016369','OP/C016370','OP/C016371','OP/C016372','OP/C016373','OP/C016374','OP/C016375','OP/C016376','OP/C016377','OP/C016378','OP/C016379','OP/C016380','OP/C016381','OP/C016382','OP/C016383','OP/C016384','OP/C016385','OP/C016386','OP/C016387','OP/C016388','OP/C016389','OP/C016390','OP/C016391','OP/C016392','OP/C016393','OP/C016394','OP/C016395','OP/C016397','OP/C016398','OP/C016399','OP/C016400','OP/C016401','OP/C016402','OP/C016403','OP/C016404','OP/C016405','OP/C016406','OP/C016407','OP/C016408','OP/C016409','OP/C016410','OP/C016411','OP/C016412','OP/C016414','OP/C016415','OP/C016416','OP/C016417','OP/C016418','OP/C016419','OP/C016420','OP/C016421','OP/C016422','OP/C016423','OP/C016424','OP/C016425','OP/C016426','OP/C016428','OP/C016429','OP/C016430','OP/C016431','OP/C016432','OP/C016433','OP/C016434','OP/C016435','OP/C016436','OP/C016437','OP/C016438','OP/C016439','OP/C016440','OP/C016441','OP/C016442','OP/C016443','OP/C016444','OP/C016445','OP/C016446','OP/C016447','OP/C016448','OP/C016449','OP/C016450','OP/C016452','OP/C016453','OP/C016454','OP/C016455','OP/C016456','OP/C016457','OP/C016458','OP/C016459','OP/C016460','OP/C016461','OP/C016462','OP/C016463','OP/C016464','OP/C016465','OP/C016466','OP/C016467','OP/C016469','OP/C016470','OP/C016471','OP/C016472','OP/C016473','OP/C016474','OP/C016475','OP/C016476','OP/C016477','OP/C016478','OP/C016479','OP/C016480','OP/C016481','OP/C016482','OP/C016483','OP/C016485','OP/C016486','OP/C016487','OP/C016488','OP/C016489','OP/C016490','OP/C016491','OP/C016493','OP/C016494','OP/C016495','OP/C016496','OP/C016497','OP/C016498','OP/C016499','OP/C016500','OP/C016501','OP/C016502','OP/C016503','OP/C016504','OP/C016505','OP/C016506','OP/C016507','OP/C016508','OP/C016509','OP/C016510','OP/C016511','OP/C016512','OP/C016513','OP/C016514','OP/C016515','OP/C016516','OP/C016517','OP/I050149','OP/I050160','OP/I050168','OP/I050175','OP/I050176','OP/I050238','OP/I050269','OP/I050284','OP/I050288','OP/I050291','OP/I050297','OP/I050298','OP/I050299','OP/I050305','OP/I050306','OP/I050309','OP/I050350','OP/I050384','OP/I050386','OP/I050398','OP/I050410','OP/I050413','OP/I050427','OP/I050429','OP/I050431','OP/I050502','OP/I050503','OP/I050506','OP/I050512','OP/I050513','OP/I050529','OP/I050551','OP/I050554','OP/I050556','OP/I050566')
AND			h.order_no	LIKE '%SB%'
ORDER BY	customer

DECLARE @OrderRow INT = 1, @OrderRows INT

SET @OrderRows = (SELECT COUNT(1) FROM @Orders)
SET  @NextCNNumber = (SELECT KeyValue FROM	VapeConnectTest.dbo.SYSSettings WHERE KeyRef = 'IMPNXBRCNNUM')

WHILE @OrderRow <= @OrderRows
BEGIN	
SELECT	@customer = customer FROM	@Orders WHERE Id = @OrderRow
	SET @FileRow = 1
	
	INSERT INTO @res
	SELECT	DISTINCT	LTRIM(RTRIM(h.customer)), 
				LTRIM(RTRIM(d.product)) AS prod,  
				SUM(d.despatched_qty*-1) AS Qty, 
				MAX(CASE list_price WHEN 0 THEN net_price ELSE list_price END) AS CreditAmount, /* SERVICE CODES HAVE 0 PRICE SO USE net_price instea */
				'31/07/19' AS Dated,
				(SELECT	COUNT (distinct d1.product) FROM		demo.scheme.opheadm h1
				INNER JOIN 	demo.scheme.opdetm d1
				ON			h1.order_no = d1.order_no
				WHERE		h1.invoice_no IN  ('OP/C015153','OP/C015154','OP/C015155','OP/C015156','OP/C015157','OP/C015158','OP/C015159','OP/C015160','OP/C015162','OP/C015163','OP/C015164','OP/C015165','OP/C015166','OP/C015167','OP/C015168','OP/C015169','OP/C015170','OP/C015171','OP/C015172','OP/C015173','OP/C015174','OP/C015175','OP/C015176','OP/C015177','OP/C015178','OP/C015179','OP/C015180','OP/C015184','OP/C015187','OP/C015190','OP/C015191','OP/C015193','OP/C015195','OP/C015196','OP/C015198','OP/C015201','OP/C015205','OP/C015216','OP/C015217','OP/C015218','OP/C015219','OP/C015220','OP/C015222','OP/C015223','OP/C015224','OP/C015225','OP/C015226','OP/C015227','OP/C015230','OP/C015231','OP/C015232','OP/C015233','OP/C015235','OP/C015236','OP/C015238','OP/C015239','OP/C015240','OP/C015241','OP/C015242','OP/C015243','OP/C015245','OP/C015246','OP/C015248','OP/C015250','OP/C015251','OP/C015253','OP/C015254','OP/C015255','OP/C015257','OP/C015260','OP/C015263','OP/C015264','OP/C015265','OP/C015268','OP/C015269','OP/C015270','OP/C015271','OP/C015272','OP/C015273','OP/C015274','OP/C015275','OP/C015276','OP/C015277','OP/C015278','OP/C015279','OP/C015280','OP/C015281','OP/C015282','OP/C015283','OP/C015284','OP/C015285','OP/C015286','OP/C015287','OP/C015288','OP/C015289','OP/C015290','OP/C015291','OP/C015292','OP/C015293','OP/C015294','OP/C015295','OP/C015296','OP/C015297','OP/C015298','OP/C015299','OP/C015300','OP/C015303','OP/C015304','OP/C015305','OP/C015306','OP/C015307','OP/C015308','OP/C015309','OP/C015310','OP/C015311','OP/C015312','OP/C015313','OP/C015314','OP/C015315','OP/C015316','OP/C015317','OP/C015318','OP/C015319','OP/C015320','OP/C015321','OP/C015322','OP/C015323','OP/C015324','OP/C015325','OP/C015326','OP/C015327','OP/C015328','OP/C015329','OP/C015330','OP/C015331','OP/C015332','OP/C015333','OP/C015334','OP/C015335','OP/C015336','OP/C015337','OP/C015338','OP/C015340','OP/C015341','OP/C015342','OP/C015343','OP/C015344','OP/C015345','OP/C015346','OP/C015347','OP/C015348','OP/C015349','OP/C015350','OP/C015351','OP/C015352','OP/C015353','OP/C015354','OP/C015355','OP/C015356','OP/C015357','OP/C015358','OP/C015359','OP/C015360','OP/C015361','OP/C015362','OP/C015363','OP/C015364','OP/C015367','OP/C015368','OP/C015369','OP/C015370','OP/C015371','OP/C015372','OP/C015373','OP/C015374','OP/C015375','OP/C015376','OP/C015377','OP/C015378','OP/C015379','OP/C015380','OP/C015381','OP/C015382','OP/C015383','OP/C015384','OP/C015385','OP/C015386','OP/C015387','OP/C015388','OP/C015389','OP/C015390','OP/C015391','OP/C015392','OP/C015393','OP/C015394','OP/C015395','OP/C015396','OP/C015397','OP/C015398','OP/C015399','OP/C015400','OP/C015401','OP/C015402','OP/C015404','OP/C015405','OP/C015406','OP/C015407','OP/C015408','OP/C015410','OP/C015411','OP/C015412','OP/C015415','OP/C015416','OP/C015417','OP/C015419','OP/C015421','OP/C015422','OP/C015424','OP/C015425','OP/C015426','OP/C015428','OP/C015431','OP/C015432','OP/C015433','OP/C015434','OP/C015435','OP/C015436','OP/C015437','OP/C015438','OP/C015440','OP/C015441','OP/C015442','OP/C015443','OP/C015445','OP/C015446','OP/C015447','OP/C015448','OP/C015449','OP/C015450','OP/C015451','OP/C015452','OP/C015453','OP/C015454','OP/C015455','OP/C015457','OP/C015458','OP/C015459','OP/C015460','OP/C015461','OP/C015462','OP/C015463','OP/C015465','OP/C015466','OP/C015468','OP/C015469','OP/C015470','OP/C015471','OP/C015473','OP/C015474','OP/C015475','OP/C015476','OP/C015477','OP/C015478','OP/C015479','OP/C015480','OP/C015481','OP/C015482','OP/C015483','OP/C015484','OP/C015507','OP/C015508','OP/C015509','OP/C015511','OP/C015512','OP/C015513','OP/C015514','OP/C015515','OP/C015516','OP/C015517','OP/C015518','OP/C015519','OP/C015520','OP/C015522','OP/C015523','OP/C015525','OP/C015528','OP/C015529','OP/C015530','OP/C015531','OP/C015532','OP/C015533','OP/C015534','OP/C015535','OP/C015536','OP/C015537','OP/C015538','OP/C015540','OP/C015541','OP/C015542','OP/C015546','OP/C015548','OP/C015549','OP/C015550','OP/C015551','OP/C015553','OP/C015554','OP/C015555','OP/C015556','OP/C015557','OP/C015558','OP/C015559','OP/C015560','OP/C015561','OP/C015562','OP/C015563','OP/C015564','OP/C015565','OP/C015566','OP/C015567','OP/C015569','OP/C015570','OP/C015571','OP/C015572','OP/C015573','OP/C015574','OP/C015575','OP/C015576','OP/C015578','OP/C015579','OP/C015580','OP/C015581','OP/C015582','OP/C015584','OP/C015585','OP/C015586','OP/C015588','OP/C015589','OP/C015590','OP/C015591','OP/C015592','OP/C015593','OP/C015594','OP/C015595','OP/C015596','OP/C015598','OP/C015599','OP/C015600','OP/C015601','OP/C015602','OP/C015603','OP/C015604','OP/C015605','OP/C015606','OP/C015608','OP/C015609','OP/C015611','OP/C015612','OP/C015613','OP/C015614','OP/C015615','OP/C015617','OP/C015618','OP/C015619','OP/C015620','OP/C015621','OP/C015622','OP/C015623','OP/C015624','OP/C015625','OP/C015626','OP/C015629','OP/C015630','OP/C015631','OP/C015632','OP/C015633','OP/C015634','OP/C015635','OP/C015637','OP/C015638','OP/C015639','OP/C015640','OP/C015641','OP/C015642','OP/C015644','OP/C015645','OP/C015649','OP/C015650','OP/C015651','OP/C015652','OP/C015653','OP/C015654','OP/C015655','OP/C015657','OP/C015658','OP/C015659','OP/C015660','OP/C015661','OP/C015662','OP/C015663','OP/C015664','OP/C015666','OP/C015667','OP/C015668','OP/C015669','OP/C015671','OP/C015672','OP/C015673','OP/C015674','OP/C015676','OP/C015677','OP/C015678','OP/C015679','OP/C015680','OP/C015681','OP/C015683','OP/C015684','OP/C015685','OP/C015686','OP/C015687','OP/C015688','OP/C015689','OP/C015690','OP/C015691','OP/C015692','OP/C015693','OP/C015694','OP/C015695','OP/C015697','OP/C015698','OP/C015699','OP/C015700','OP/C015701','OP/C015702','OP/C015703','OP/C015705','OP/C015706','OP/C015708','OP/C015709','OP/C015710','OP/C015711','OP/C015712','OP/C015713','OP/C015714','OP/C015715','OP/C015716','OP/C015717','OP/C015718','OP/C015719','OP/C015720','OP/C015722','OP/C015723','OP/C015724','OP/C015725','OP/C015726','OP/C015727','OP/C015728','OP/C015729','OP/C015730','OP/C015731','OP/C015732','OP/C015733','OP/C015735','OP/C015736','OP/C015737','OP/C015738','OP/C015742','OP/C015743','OP/C015744','OP/C015745','OP/C015746','OP/C015747','OP/C015748','OP/C015749','OP/C015750','OP/C015751','OP/C015752','OP/C015753','OP/C015754','OP/C015755','OP/C015756','OP/C015758','OP/C015759','OP/C015764','OP/C015765','OP/C015767','OP/C015768','OP/C015769','OP/C015770','OP/C015771','OP/C015772','OP/C015773','OP/C015774','OP/C015775','OP/C015776','OP/C015777','OP/C015778','OP/C015779','OP/C015780','OP/C015781','OP/C015783','OP/C015784','OP/C015785','OP/C015786','OP/C015787','OP/C015788','OP/C015789','OP/C015790','OP/C015791','OP/C015792','OP/C015793','OP/C015794','OP/C015795','OP/C015796','OP/C015797','OP/C015798','OP/C015799','OP/C015801','OP/C015802','OP/C015803','OP/C015805','OP/C015806','OP/C015807','OP/C015808','OP/C015809','OP/C015810','OP/C015812','OP/C015813','OP/C015814','OP/C015815','OP/C015816','OP/C015818','OP/C015819','OP/C015820','OP/C015821','OP/C015822','OP/C015823','OP/C015824','OP/C015825','OP/C015827','OP/C015828','OP/C015830','OP/C015831','OP/C015832','OP/C015834','OP/C015835','OP/C015836','OP/C015838','OP/C015840','OP/C015841','OP/C015842','OP/C015843','OP/C015844','OP/C015845','OP/C015846','OP/C015847','OP/C015848','OP/C015849','OP/C015850','OP/C015851','OP/C015852','OP/C015853','OP/C015854','OP/C015855','OP/C015856','OP/C015857','OP/C015858','OP/C015859','OP/C015860','OP/C015861','OP/C015862','OP/C015863','OP/C015864','OP/C015865','OP/C015866','OP/C015867','OP/C015868','OP/C015869','OP/C015870','OP/C015871','OP/C015873','OP/C015874','OP/C015875','OP/C015876','OP/C015877','OP/C015878','OP/C015879','OP/C015880','OP/C015881','OP/C015882','OP/C015883','OP/C015884','OP/C015885','OP/C015886','OP/C015887','OP/C015888','OP/C015890','OP/C015891','OP/C015892','OP/C015893','OP/C015894','OP/C015895','OP/C015896','OP/C015897','OP/C015898','OP/C015899','OP/C015900','OP/C015901','OP/C015902','OP/C015904','OP/C015905','OP/C015906','OP/C015907','OP/C015908','OP/C015909','OP/C015910','OP/C015911','OP/C015912','OP/C015913','OP/C015914','OP/C015915','OP/C015916','OP/C015917','OP/C015918','OP/C015919','OP/C015920','OP/C015921','OP/C015922','OP/C015923','OP/C015924','OP/C015925','OP/C015926','OP/C015928','OP/C015929','OP/C015930','OP/C015931','OP/C015932','OP/C015933','OP/C015934','OP/C015935','OP/C015936','OP/C015937','OP/C015938','OP/C015939','OP/C015940','OP/C015941','OP/C015942','OP/C015943','OP/C015945','OP/C015946','OP/C015947','OP/C015948','OP/C015949','OP/C015950','OP/C015951','OP/C015952','OP/C015953','OP/C015954','OP/C015955','OP/C015956','OP/C015957','OP/C015958','OP/C015959','OP/C015961','OP/C015962','OP/C015963','OP/C015964','OP/C015965','OP/C015966','OP/C015967','OP/C015969','OP/C015970','OP/C015971','OP/C015972','OP/C015973','OP/C015974','OP/C015975','OP/C015976','OP/C015977','OP/C015978','OP/C015979','OP/C015980','OP/C015981','OP/C015982','OP/C015983','OP/C015984','OP/C015985','OP/C015986','OP/C015987','OP/C015988','OP/C015989','OP/C015990','OP/C015991','OP/C015992','OP/C015993','OP/C015994','OP/C015995','OP/C015996','OP/C015997','OP/C015998','OP/C015999','OP/C016000','OP/C016001','OP/C016002','OP/C016004','OP/C016005','OP/C016006','OP/C016007','OP/C016008','OP/C016009','OP/C016010','OP/C016011','OP/C016012','OP/C016013','OP/C016014','OP/C016015','OP/C016016','OP/C016017','OP/C016018','OP/C016019','OP/C016021','OP/C016022','OP/C016023','OP/C016024','OP/C016025','OP/C016026','OP/C016027','OP/C016028','OP/C016029','OP/C016030','OP/C016031','OP/C016032','OP/C016033','OP/C016035','OP/C016036','OP/C016037','OP/C016038','OP/C016039','OP/C016040','OP/C016041','OP/C016042','OP/C016043','OP/C016044','OP/C016045','OP/C016046','OP/C016047','OP/C016048','OP/C016049','OP/C016050','OP/C016051','OP/C016052','OP/C016053','OP/C016054','OP/C016055','OP/C016056','OP/C016057','OP/C016059','OP/C016060','OP/C016061','OP/C016062','OP/C016063','OP/C016064','OP/C016065','OP/C016066','OP/C016067','OP/C016068','OP/C016069','OP/C016070','OP/C016071','OP/C016072','OP/C016073','OP/C016074','OP/C016076','OP/C016077','OP/C016078','OP/C016079','OP/C016080','OP/C016081','OP/C016082','OP/C016083','OP/C016084','OP/C016085','OP/C016086','OP/C016087','OP/C016088','OP/C016089','OP/C016090','OP/C016092','OP/C016093','OP/C016094','OP/C016095','OP/C016096','OP/C016097','OP/C016098','OP/C016100','OP/C016101','OP/C016102','OP/C016103','OP/C016104','OP/C016105','OP/C016106','OP/C016107','OP/C016108','OP/C016109','OP/C016110','OP/C016111','OP/C016112','OP/C016113','OP/C016114','OP/C016115','OP/C016116','OP/C016117','OP/C016118','OP/C016119','OP/C016120','OP/C016121','OP/C016122','OP/C016123','OP/C016124','OP/C016125','OP/C016126','OP/C016127','OP/C016128','OP/C016129','OP/C016130','OP/C016131','OP/C016132','OP/C016133','OP/C016135','OP/C016136','OP/C016137','OP/C016138','OP/C016139','OP/C016140','OP/C016141','OP/C016142','OP/C016143','OP/C016144','OP/C016145','OP/C016146','OP/C016147','OP/C016148','OP/C016149','OP/C016150','OP/C016152','OP/C016153','OP/C016154','OP/C016155','OP/C016156','OP/C016157','OP/C016158','OP/C016159','OP/C016160','OP/C016161','OP/C016162','OP/C016163','OP/C016164','OP/C016166','OP/C016167','OP/C016168','OP/C016169','OP/C016170','OP/C016171','OP/C016172','OP/C016173','OP/C016174','OP/C016175','OP/C016176','OP/C016177','OP/C016178','OP/C016179','OP/C016180','OP/C016181','OP/C016182','OP/C016183','OP/C016184','OP/C016185','OP/C016186','OP/C016187','OP/C016188','OP/C016190','OP/C016191','OP/C016192','OP/C016193','OP/C016194','OP/C016195','OP/C016196','OP/C016197','OP/C016198','OP/C016199','OP/C016200','OP/C016201','OP/C016202','OP/C016203','OP/C016204','OP/C016205','OP/C016207','OP/C016208','OP/C016209','OP/C016210','OP/C016211','OP/C016212','OP/C016213','OP/C016214','OP/C016215','OP/C016216','OP/C016217','OP/C016218','OP/C016219','OP/C016220','OP/C016221','OP/C016223','OP/C016224','OP/C016225','OP/C016226','OP/C016227','OP/C016228','OP/C016229','OP/C016231','OP/C016232','OP/C016233','OP/C016234','OP/C016235','OP/C016236','OP/C016237','OP/C016238','OP/C016239','OP/C016240','OP/C016241','OP/C016242','OP/C016243','OP/C016244','OP/C016245','OP/C016246','OP/C016247','OP/C016248','OP/C016249','OP/C016250','OP/C016251','OP/C016252','OP/C016253','OP/C016254','OP/C016255','OP/C016256','OP/C016257','OP/C016258','OP/C016259','OP/C016260','OP/C016261','OP/C016262','OP/C016263','OP/C016264','OP/C016266','OP/C016267','OP/C016268','OP/C016269','OP/C016270','OP/C016271','OP/C016272','OP/C016273','OP/C016274','OP/C016275','OP/C016276','OP/C016277','OP/C016278','OP/C016279','OP/C016280','OP/C016281','OP/C016283','OP/C016284','OP/C016285','OP/C016286','OP/C016287','OP/C016288','OP/C016289','OP/C016290','OP/C016291','OP/C016292','OP/C016293','OP/C016294','OP/C016295','OP/C016297','OP/C016298','OP/C016299','OP/C016300','OP/C016301','OP/C016302','OP/C016303','OP/C016304','OP/C016305','OP/C016306','OP/C016307','OP/C016308','OP/C016309','OP/C016310','OP/C016311','OP/C016312','OP/C016313','OP/C016314','OP/C016315','OP/C016316','OP/C016317','OP/C016318','OP/C016319','OP/C016321','OP/C016322','OP/C016323','OP/C016324','OP/C016325','OP/C016326','OP/C016327','OP/C016328','OP/C016329','OP/C016330','OP/C016331','OP/C016332','OP/C016333','OP/C016334','OP/C016335','OP/C016336','OP/C016338','OP/C016339','OP/C016340','OP/C016341','OP/C016342','OP/C016343','OP/C016344','OP/C016345','OP/C016346','OP/C016347','OP/C016348','OP/C016349','OP/C016350','OP/C016351','OP/C016352','OP/C016354','OP/C016355','OP/C016356','OP/C016357','OP/C016358','OP/C016359','OP/C016360','OP/C016362','OP/C016363','OP/C016364','OP/C016365','OP/C016366','OP/C016367','OP/C016368','OP/C016369','OP/C016370','OP/C016371','OP/C016372','OP/C016373','OP/C016374','OP/C016375','OP/C016376','OP/C016377','OP/C016378','OP/C016379','OP/C016380','OP/C016381','OP/C016382','OP/C016383','OP/C016384','OP/C016385','OP/C016386','OP/C016387','OP/C016388','OP/C016389','OP/C016390','OP/C016391','OP/C016392','OP/C016393','OP/C016394','OP/C016395','OP/C016397','OP/C016398','OP/C016399','OP/C016400','OP/C016401','OP/C016402','OP/C016403','OP/C016404','OP/C016405','OP/C016406','OP/C016407','OP/C016408','OP/C016409','OP/C016410','OP/C016411','OP/C016412','OP/C016414','OP/C016415','OP/C016416','OP/C016417','OP/C016418','OP/C016419','OP/C016420','OP/C016421','OP/C016422','OP/C016423','OP/C016424','OP/C016425','OP/C016426','OP/C016428','OP/C016429','OP/C016430','OP/C016431','OP/C016432','OP/C016433','OP/C016434','OP/C016435','OP/C016436','OP/C016437','OP/C016438','OP/C016439','OP/C016440','OP/C016441','OP/C016442','OP/C016443','OP/C016444','OP/C016445','OP/C016446','OP/C016447','OP/C016448','OP/C016449','OP/C016450','OP/C016452','OP/C016453','OP/C016454','OP/C016455','OP/C016456','OP/C016457','OP/C016458','OP/C016459','OP/C016460','OP/C016461','OP/C016462','OP/C016463','OP/C016464','OP/C016465','OP/C016466','OP/C016467','OP/C016469','OP/C016470','OP/C016471','OP/C016472','OP/C016473','OP/C016474','OP/C016475','OP/C016476','OP/C016477','OP/C016478','OP/C016479','OP/C016480','OP/C016481','OP/C016482','OP/C016483','OP/C016485','OP/C016486','OP/C016487','OP/C016488','OP/C016489','OP/C016490','OP/C016491','OP/C016493','OP/C016494','OP/C016495','OP/C016496','OP/C016497','OP/C016498','OP/C016499','OP/C016500','OP/C016501','OP/C016502','OP/C016503','OP/C016504','OP/C016505','OP/C016506','OP/C016507','OP/C016508','OP/C016509','OP/C016510','OP/C016511','OP/C016512','OP/C016513','OP/C016514','OP/C016515','OP/C016516','OP/C016517','OP/I050149','OP/I050160','OP/I050168','OP/I050175','OP/I050176','OP/I050238','OP/I050269','OP/I050284','OP/I050288','OP/I050291','OP/I050297','OP/I050298','OP/I050299','OP/I050305','OP/I050306','OP/I050309','OP/I050350','OP/I050384','OP/I050386','OP/I050398','OP/I050410','OP/I050413','OP/I050427','OP/I050429','OP/I050431','OP/I050502','OP/I050503','OP/I050506','OP/I050512','OP/I050513','OP/I050529','OP/I050551','OP/I050554','OP/I050556','OP/I050566')
				AND			d1.despatched_qty > 0
				AND			h1.order_no	LIKE '%SB%'
				AND			h1.customer = @customer) AS NumOfLines
	FROM		demo.scheme.opheadm h
	INNER JOIN 	demo.scheme.opdetm d
	ON			h.order_no = d.order_no
	WHERE		h.invoice_no IN  ('OP/C015153','OP/C015154','OP/C015155','OP/C015156','OP/C015157','OP/C015158','OP/C015159','OP/C015160','OP/C015162','OP/C015163','OP/C015164','OP/C015165','OP/C015166','OP/C015167','OP/C015168','OP/C015169','OP/C015170','OP/C015171','OP/C015172','OP/C015173','OP/C015174','OP/C015175','OP/C015176','OP/C015177','OP/C015178','OP/C015179','OP/C015180','OP/C015184','OP/C015187','OP/C015190','OP/C015191','OP/C015193','OP/C015195','OP/C015196','OP/C015198','OP/C015201','OP/C015205','OP/C015216','OP/C015217','OP/C015218','OP/C015219','OP/C015220','OP/C015222','OP/C015223','OP/C015224','OP/C015225','OP/C015226','OP/C015227','OP/C015230','OP/C015231','OP/C015232','OP/C015233','OP/C015235','OP/C015236','OP/C015238','OP/C015239','OP/C015240','OP/C015241','OP/C015242','OP/C015243','OP/C015245','OP/C015246','OP/C015248','OP/C015250','OP/C015251','OP/C015253','OP/C015254','OP/C015255','OP/C015257','OP/C015260','OP/C015263','OP/C015264','OP/C015265','OP/C015268','OP/C015269','OP/C015270','OP/C015271','OP/C015272','OP/C015273','OP/C015274','OP/C015275','OP/C015276','OP/C015277','OP/C015278','OP/C015279','OP/C015280','OP/C015281','OP/C015282','OP/C015283','OP/C015284','OP/C015285','OP/C015286','OP/C015287','OP/C015288','OP/C015289','OP/C015290','OP/C015291','OP/C015292','OP/C015293','OP/C015294','OP/C015295','OP/C015296','OP/C015297','OP/C015298','OP/C015299','OP/C015300','OP/C015303','OP/C015304','OP/C015305','OP/C015306','OP/C015307','OP/C015308','OP/C015309','OP/C015310','OP/C015311','OP/C015312','OP/C015313','OP/C015314','OP/C015315','OP/C015316','OP/C015317','OP/C015318','OP/C015319','OP/C015320','OP/C015321','OP/C015322','OP/C015323','OP/C015324','OP/C015325','OP/C015326','OP/C015327','OP/C015328','OP/C015329','OP/C015330','OP/C015331','OP/C015332','OP/C015333','OP/C015334','OP/C015335','OP/C015336','OP/C015337','OP/C015338','OP/C015340','OP/C015341','OP/C015342','OP/C015343','OP/C015344','OP/C015345','OP/C015346','OP/C015347','OP/C015348','OP/C015349','OP/C015350','OP/C015351','OP/C015352','OP/C015353','OP/C015354','OP/C015355','OP/C015356','OP/C015357','OP/C015358','OP/C015359','OP/C015360','OP/C015361','OP/C015362','OP/C015363','OP/C015364','OP/C015367','OP/C015368','OP/C015369','OP/C015370','OP/C015371','OP/C015372','OP/C015373','OP/C015374','OP/C015375','OP/C015376','OP/C015377','OP/C015378','OP/C015379','OP/C015380','OP/C015381','OP/C015382','OP/C015383','OP/C015384','OP/C015385','OP/C015386','OP/C015387','OP/C015388','OP/C015389','OP/C015390','OP/C015391','OP/C015392','OP/C015393','OP/C015394','OP/C015395','OP/C015396','OP/C015397','OP/C015398','OP/C015399','OP/C015400','OP/C015401','OP/C015402','OP/C015404','OP/C015405','OP/C015406','OP/C015407','OP/C015408','OP/C015410','OP/C015411','OP/C015412','OP/C015415','OP/C015416','OP/C015417','OP/C015419','OP/C015421','OP/C015422','OP/C015424','OP/C015425','OP/C015426','OP/C015428','OP/C015431','OP/C015432','OP/C015433','OP/C015434','OP/C015435','OP/C015436','OP/C015437','OP/C015438','OP/C015440','OP/C015441','OP/C015442','OP/C015443','OP/C015445','OP/C015446','OP/C015447','OP/C015448','OP/C015449','OP/C015450','OP/C015451','OP/C015452','OP/C015453','OP/C015454','OP/C015455','OP/C015457','OP/C015458','OP/C015459','OP/C015460','OP/C015461','OP/C015462','OP/C015463','OP/C015465','OP/C015466','OP/C015468','OP/C015469','OP/C015470','OP/C015471','OP/C015473','OP/C015474','OP/C015475','OP/C015476','OP/C015477','OP/C015478','OP/C015479','OP/C015480','OP/C015481','OP/C015482','OP/C015483','OP/C015484','OP/C015507','OP/C015508','OP/C015509','OP/C015511','OP/C015512','OP/C015513','OP/C015514','OP/C015515','OP/C015516','OP/C015517','OP/C015518','OP/C015519','OP/C015520','OP/C015522','OP/C015523','OP/C015525','OP/C015528','OP/C015529','OP/C015530','OP/C015531','OP/C015532','OP/C015533','OP/C015534','OP/C015535','OP/C015536','OP/C015537','OP/C015538','OP/C015540','OP/C015541','OP/C015542','OP/C015546','OP/C015548','OP/C015549','OP/C015550','OP/C015551','OP/C015553','OP/C015554','OP/C015555','OP/C015556','OP/C015557','OP/C015558','OP/C015559','OP/C015560','OP/C015561','OP/C015562','OP/C015563','OP/C015564','OP/C015565','OP/C015566','OP/C015567','OP/C015569','OP/C015570','OP/C015571','OP/C015572','OP/C015573','OP/C015574','OP/C015575','OP/C015576','OP/C015578','OP/C015579','OP/C015580','OP/C015581','OP/C015582','OP/C015584','OP/C015585','OP/C015586','OP/C015588','OP/C015589','OP/C015590','OP/C015591','OP/C015592','OP/C015593','OP/C015594','OP/C015595','OP/C015596','OP/C015598','OP/C015599','OP/C015600','OP/C015601','OP/C015602','OP/C015603','OP/C015604','OP/C015605','OP/C015606','OP/C015608','OP/C015609','OP/C015611','OP/C015612','OP/C015613','OP/C015614','OP/C015615','OP/C015617','OP/C015618','OP/C015619','OP/C015620','OP/C015621','OP/C015622','OP/C015623','OP/C015624','OP/C015625','OP/C015626','OP/C015629','OP/C015630','OP/C015631','OP/C015632','OP/C015633','OP/C015634','OP/C015635','OP/C015637','OP/C015638','OP/C015639','OP/C015640','OP/C015641','OP/C015642','OP/C015644','OP/C015645','OP/C015649','OP/C015650','OP/C015651','OP/C015652','OP/C015653','OP/C015654','OP/C015655','OP/C015657','OP/C015658','OP/C015659','OP/C015660','OP/C015661','OP/C015662','OP/C015663','OP/C015664','OP/C015666','OP/C015667','OP/C015668','OP/C015669','OP/C015671','OP/C015672','OP/C015673','OP/C015674','OP/C015676','OP/C015677','OP/C015678','OP/C015679','OP/C015680','OP/C015681','OP/C015683','OP/C015684','OP/C015685','OP/C015686','OP/C015687','OP/C015688','OP/C015689','OP/C015690','OP/C015691','OP/C015692','OP/C015693','OP/C015694','OP/C015695','OP/C015697','OP/C015698','OP/C015699','OP/C015700','OP/C015701','OP/C015702','OP/C015703','OP/C015705','OP/C015706','OP/C015708','OP/C015709','OP/C015710','OP/C015711','OP/C015712','OP/C015713','OP/C015714','OP/C015715','OP/C015716','OP/C015717','OP/C015718','OP/C015719','OP/C015720','OP/C015722','OP/C015723','OP/C015724','OP/C015725','OP/C015726','OP/C015727','OP/C015728','OP/C015729','OP/C015730','OP/C015731','OP/C015732','OP/C015733','OP/C015735','OP/C015736','OP/C015737','OP/C015738','OP/C015742','OP/C015743','OP/C015744','OP/C015745','OP/C015746','OP/C015747','OP/C015748','OP/C015749','OP/C015750','OP/C015751','OP/C015752','OP/C015753','OP/C015754','OP/C015755','OP/C015756','OP/C015758','OP/C015759','OP/C015764','OP/C015765','OP/C015767','OP/C015768','OP/C015769','OP/C015770','OP/C015771','OP/C015772','OP/C015773','OP/C015774','OP/C015775','OP/C015776','OP/C015777','OP/C015778','OP/C015779','OP/C015780','OP/C015781','OP/C015783','OP/C015784','OP/C015785','OP/C015786','OP/C015787','OP/C015788','OP/C015789','OP/C015790','OP/C015791','OP/C015792','OP/C015793','OP/C015794','OP/C015795','OP/C015796','OP/C015797','OP/C015798','OP/C015799','OP/C015801','OP/C015802','OP/C015803','OP/C015805','OP/C015806','OP/C015807','OP/C015808','OP/C015809','OP/C015810','OP/C015812','OP/C015813','OP/C015814','OP/C015815','OP/C015816','OP/C015818','OP/C015819','OP/C015820','OP/C015821','OP/C015822','OP/C015823','OP/C015824','OP/C015825','OP/C015827','OP/C015828','OP/C015830','OP/C015831','OP/C015832','OP/C015834','OP/C015835','OP/C015836','OP/C015838','OP/C015840','OP/C015841','OP/C015842','OP/C015843','OP/C015844','OP/C015845','OP/C015846','OP/C015847','OP/C015848','OP/C015849','OP/C015850','OP/C015851','OP/C015852','OP/C015853','OP/C015854','OP/C015855','OP/C015856','OP/C015857','OP/C015858','OP/C015859','OP/C015860','OP/C015861','OP/C015862','OP/C015863','OP/C015864','OP/C015865','OP/C015866','OP/C015867','OP/C015868','OP/C015869','OP/C015870','OP/C015871','OP/C015873','OP/C015874','OP/C015875','OP/C015876','OP/C015877','OP/C015878','OP/C015879','OP/C015880','OP/C015881','OP/C015882','OP/C015883','OP/C015884','OP/C015885','OP/C015886','OP/C015887','OP/C015888','OP/C015890','OP/C015891','OP/C015892','OP/C015893','OP/C015894','OP/C015895','OP/C015896','OP/C015897','OP/C015898','OP/C015899','OP/C015900','OP/C015901','OP/C015902','OP/C015904','OP/C015905','OP/C015906','OP/C015907','OP/C015908','OP/C015909','OP/C015910','OP/C015911','OP/C015912','OP/C015913','OP/C015914','OP/C015915','OP/C015916','OP/C015917','OP/C015918','OP/C015919','OP/C015920','OP/C015921','OP/C015922','OP/C015923','OP/C015924','OP/C015925','OP/C015926','OP/C015928','OP/C015929','OP/C015930','OP/C015931','OP/C015932','OP/C015933','OP/C015934','OP/C015935','OP/C015936','OP/C015937','OP/C015938','OP/C015939','OP/C015940','OP/C015941','OP/C015942','OP/C015943','OP/C015945','OP/C015946','OP/C015947','OP/C015948','OP/C015949','OP/C015950','OP/C015951','OP/C015952','OP/C015953','OP/C015954','OP/C015955','OP/C015956','OP/C015957','OP/C015958','OP/C015959','OP/C015961','OP/C015962','OP/C015963','OP/C015964','OP/C015965','OP/C015966','OP/C015967','OP/C015969','OP/C015970','OP/C015971','OP/C015972','OP/C015973','OP/C015974','OP/C015975','OP/C015976','OP/C015977','OP/C015978','OP/C015979','OP/C015980','OP/C015981','OP/C015982','OP/C015983','OP/C015984','OP/C015985','OP/C015986','OP/C015987','OP/C015988','OP/C015989','OP/C015990','OP/C015991','OP/C015992','OP/C015993','OP/C015994','OP/C015995','OP/C015996','OP/C015997','OP/C015998','OP/C015999','OP/C016000','OP/C016001','OP/C016002','OP/C016004','OP/C016005','OP/C016006','OP/C016007','OP/C016008','OP/C016009','OP/C016010','OP/C016011','OP/C016012','OP/C016013','OP/C016014','OP/C016015','OP/C016016','OP/C016017','OP/C016018','OP/C016019','OP/C016021','OP/C016022','OP/C016023','OP/C016024','OP/C016025','OP/C016026','OP/C016027','OP/C016028','OP/C016029','OP/C016030','OP/C016031','OP/C016032','OP/C016033','OP/C016035','OP/C016036','OP/C016037','OP/C016038','OP/C016039','OP/C016040','OP/C016041','OP/C016042','OP/C016043','OP/C016044','OP/C016045','OP/C016046','OP/C016047','OP/C016048','OP/C016049','OP/C016050','OP/C016051','OP/C016052','OP/C016053','OP/C016054','OP/C016055','OP/C016056','OP/C016057','OP/C016059','OP/C016060','OP/C016061','OP/C016062','OP/C016063','OP/C016064','OP/C016065','OP/C016066','OP/C016067','OP/C016068','OP/C016069','OP/C016070','OP/C016071','OP/C016072','OP/C016073','OP/C016074','OP/C016076','OP/C016077','OP/C016078','OP/C016079','OP/C016080','OP/C016081','OP/C016082','OP/C016083','OP/C016084','OP/C016085','OP/C016086','OP/C016087','OP/C016088','OP/C016089','OP/C016090','OP/C016092','OP/C016093','OP/C016094','OP/C016095','OP/C016096','OP/C016097','OP/C016098','OP/C016100','OP/C016101','OP/C016102','OP/C016103','OP/C016104','OP/C016105','OP/C016106','OP/C016107','OP/C016108','OP/C016109','OP/C016110','OP/C016111','OP/C016112','OP/C016113','OP/C016114','OP/C016115','OP/C016116','OP/C016117','OP/C016118','OP/C016119','OP/C016120','OP/C016121','OP/C016122','OP/C016123','OP/C016124','OP/C016125','OP/C016126','OP/C016127','OP/C016128','OP/C016129','OP/C016130','OP/C016131','OP/C016132','OP/C016133','OP/C016135','OP/C016136','OP/C016137','OP/C016138','OP/C016139','OP/C016140','OP/C016141','OP/C016142','OP/C016143','OP/C016144','OP/C016145','OP/C016146','OP/C016147','OP/C016148','OP/C016149','OP/C016150','OP/C016152','OP/C016153','OP/C016154','OP/C016155','OP/C016156','OP/C016157','OP/C016158','OP/C016159','OP/C016160','OP/C016161','OP/C016162','OP/C016163','OP/C016164','OP/C016166','OP/C016167','OP/C016168','OP/C016169','OP/C016170','OP/C016171','OP/C016172','OP/C016173','OP/C016174','OP/C016175','OP/C016176','OP/C016177','OP/C016178','OP/C016179','OP/C016180','OP/C016181','OP/C016182','OP/C016183','OP/C016184','OP/C016185','OP/C016186','OP/C016187','OP/C016188','OP/C016190','OP/C016191','OP/C016192','OP/C016193','OP/C016194','OP/C016195','OP/C016196','OP/C016197','OP/C016198','OP/C016199','OP/C016200','OP/C016201','OP/C016202','OP/C016203','OP/C016204','OP/C016205','OP/C016207','OP/C016208','OP/C016209','OP/C016210','OP/C016211','OP/C016212','OP/C016213','OP/C016214','OP/C016215','OP/C016216','OP/C016217','OP/C016218','OP/C016219','OP/C016220','OP/C016221','OP/C016223','OP/C016224','OP/C016225','OP/C016226','OP/C016227','OP/C016228','OP/C016229','OP/C016231','OP/C016232','OP/C016233','OP/C016234','OP/C016235','OP/C016236','OP/C016237','OP/C016238','OP/C016239','OP/C016240','OP/C016241','OP/C016242','OP/C016243','OP/C016244','OP/C016245','OP/C016246','OP/C016247','OP/C016248','OP/C016249','OP/C016250','OP/C016251','OP/C016252','OP/C016253','OP/C016254','OP/C016255','OP/C016256','OP/C016257','OP/C016258','OP/C016259','OP/C016260','OP/C016261','OP/C016262','OP/C016263','OP/C016264','OP/C016266','OP/C016267','OP/C016268','OP/C016269','OP/C016270','OP/C016271','OP/C016272','OP/C016273','OP/C016274','OP/C016275','OP/C016276','OP/C016277','OP/C016278','OP/C016279','OP/C016280','OP/C016281','OP/C016283','OP/C016284','OP/C016285','OP/C016286','OP/C016287','OP/C016288','OP/C016289','OP/C016290','OP/C016291','OP/C016292','OP/C016293','OP/C016294','OP/C016295','OP/C016297','OP/C016298','OP/C016299','OP/C016300','OP/C016301','OP/C016302','OP/C016303','OP/C016304','OP/C016305','OP/C016306','OP/C016307','OP/C016308','OP/C016309','OP/C016310','OP/C016311','OP/C016312','OP/C016313','OP/C016314','OP/C016315','OP/C016316','OP/C016317','OP/C016318','OP/C016319','OP/C016321','OP/C016322','OP/C016323','OP/C016324','OP/C016325','OP/C016326','OP/C016327','OP/C016328','OP/C016329','OP/C016330','OP/C016331','OP/C016332','OP/C016333','OP/C016334','OP/C016335','OP/C016336','OP/C016338','OP/C016339','OP/C016340','OP/C016341','OP/C016342','OP/C016343','OP/C016344','OP/C016345','OP/C016346','OP/C016347','OP/C016348','OP/C016349','OP/C016350','OP/C016351','OP/C016352','OP/C016354','OP/C016355','OP/C016356','OP/C016357','OP/C016358','OP/C016359','OP/C016360','OP/C016362','OP/C016363','OP/C016364','OP/C016365','OP/C016366','OP/C016367','OP/C016368','OP/C016369','OP/C016370','OP/C016371','OP/C016372','OP/C016373','OP/C016374','OP/C016375','OP/C016376','OP/C016377','OP/C016378','OP/C016379','OP/C016380','OP/C016381','OP/C016382','OP/C016383','OP/C016384','OP/C016385','OP/C016386','OP/C016387','OP/C016388','OP/C016389','OP/C016390','OP/C016391','OP/C016392','OP/C016393','OP/C016394','OP/C016395','OP/C016397','OP/C016398','OP/C016399','OP/C016400','OP/C016401','OP/C016402','OP/C016403','OP/C016404','OP/C016405','OP/C016406','OP/C016407','OP/C016408','OP/C016409','OP/C016410','OP/C016411','OP/C016412','OP/C016414','OP/C016415','OP/C016416','OP/C016417','OP/C016418','OP/C016419','OP/C016420','OP/C016421','OP/C016422','OP/C016423','OP/C016424','OP/C016425','OP/C016426','OP/C016428','OP/C016429','OP/C016430','OP/C016431','OP/C016432','OP/C016433','OP/C016434','OP/C016435','OP/C016436','OP/C016437','OP/C016438','OP/C016439','OP/C016440','OP/C016441','OP/C016442','OP/C016443','OP/C016444','OP/C016445','OP/C016446','OP/C016447','OP/C016448','OP/C016449','OP/C016450','OP/C016452','OP/C016453','OP/C016454','OP/C016455','OP/C016456','OP/C016457','OP/C016458','OP/C016459','OP/C016460','OP/C016461','OP/C016462','OP/C016463','OP/C016464','OP/C016465','OP/C016466','OP/C016467','OP/C016469','OP/C016470','OP/C016471','OP/C016472','OP/C016473','OP/C016474','OP/C016475','OP/C016476','OP/C016477','OP/C016478','OP/C016479','OP/C016480','OP/C016481','OP/C016482','OP/C016483','OP/C016485','OP/C016486','OP/C016487','OP/C016488','OP/C016489','OP/C016490','OP/C016491','OP/C016493','OP/C016494','OP/C016495','OP/C016496','OP/C016497','OP/C016498','OP/C016499','OP/C016500','OP/C016501','OP/C016502','OP/C016503','OP/C016504','OP/C016505','OP/C016506','OP/C016507','OP/C016508','OP/C016509','OP/C016510','OP/C016511','OP/C016512','OP/C016513','OP/C016514','OP/C016515','OP/C016516','OP/C016517','OP/I050149','OP/I050160','OP/I050168','OP/I050175','OP/I050176','OP/I050238','OP/I050269','OP/I050284','OP/I050288','OP/I050291','OP/I050297','OP/I050298','OP/I050299','OP/I050305','OP/I050306','OP/I050309','OP/I050350','OP/I050384','OP/I050386','OP/I050398','OP/I050410','OP/I050413','OP/I050427','OP/I050429','OP/I050431','OP/I050502','OP/I050503','OP/I050506','OP/I050512','OP/I050513','OP/I050529','OP/I050551','OP/I050554','OP/I050556','OP/I050566')
	AND			d.despatched_qty > 0
	AND			h.order_no	LIKE '%SB%'
	AND			h.customer = @customer
	GROUP BY 	LTRIM(RTRIM(h.customer)), LTRIM(RTRIM(d.product))
	ORDER BY	1, 2
	
	-- 03 HEADER LINE
	INSERT INTO #CreditNotes
	SELECT '00|SRNXY|SOCREATE|Credit Notes|'
	
	SET @Rows = (SELECT COUNT(1) FROM @res)
	INSERT INTO #CreditNotes
			SELECT		'03|0|=CNF'+REPLACE(STR(@NextCNNumber, 5), SPACE(1), '0')+'|3|'+SageRef+'|12|'+defDate+'|13|'+defDate+'|14|'+defDate+'|15|'+defDate+'|16|'+defDate+'|24|4|25|N|26|N|32|0|34|0|35|0|36|0|37|0|38|0|39|0|41|N|45|'+CAST(OrderLines AS varchar(4))+'|46|N|85|0|86|0|87|0|'			
			FROM		@res
			WHERE		Id = @Row
	
	WHILE @Row <= @Rows
	BEGIN			
		INSERT INTO #CreditNotes
		SELECT '04|0|=CNF'+REPLACE(STR(@NextCNNumber, 5), SPACE(1), '0')+'|2|'  + REPLACE(STR(CAST(@FileRow AS VARCHAR(5)), 4), SPACE(1), ' ')+'|3|'+ProductCode+'|4|'+
		CASE WHEN ProductCode LIKE	'GEN%' THEN 'S|5|' else 'P|5|SL' END +'|9||20|'+Quantity+'|21|'+Quantity+'|22|'+Quantity+'|24|' + CAST(CreditAmount AS VARCHAR(10)) + '|25|0|30|N|'
		FROM	@res
		WHERE	Id = @Row
		SET @Row = @Row + 1
		SET @FileRow = @FileRow +1
	END


-- end this CN/SO do the next one

	SET  @NextCNNumber = @NextCNNumber +1 

SET @OrderRow = @OrderRow + 1
END

SELECT	*
FROM		#CreditNotes

	-- STOCK ADJ FILE
	INSERT INTO #StockAdjusts
	SELECT		'00|SR1|000000|Stock Adj|'

	INSERT INTO #StockAdjusts	
	SELECT		'24|1|SL|2|'+LTRIM(RTRIM(d.product))+'|3|'+CAST(SUM(d.order_qty) AS VARCHAR(4))+'|4|31/07/19|6||8|DUPLICATE July Orders|9|'+RIGHT(LTRIM(RTRIM(h.customer)),2)+'|16||21||'
	FROM		demo.scheme.opheadm h
	INNER JOIN 	demo.scheme.opdetm d
	ON			h.order_no = d.order_no
	WHERE		h.invoice_no IN  ('OP/C015153','OP/C015154','OP/C015155','OP/C015156','OP/C015157','OP/C015158','OP/C015159','OP/C015160','OP/C015162','OP/C015163','OP/C015164','OP/C015165','OP/C015166','OP/C015167','OP/C015168','OP/C015169','OP/C015170','OP/C015171','OP/C015172','OP/C015173','OP/C015174','OP/C015175','OP/C015176','OP/C015177','OP/C015178','OP/C015179','OP/C015180','OP/C015184','OP/C015187','OP/C015190','OP/C015191','OP/C015193','OP/C015195','OP/C015196','OP/C015198','OP/C015201','OP/C015205','OP/C015216','OP/C015217','OP/C015218','OP/C015219','OP/C015220','OP/C015222','OP/C015223','OP/C015224','OP/C015225','OP/C015226','OP/C015227','OP/C015230','OP/C015231','OP/C015232','OP/C015233','OP/C015235','OP/C015236','OP/C015238','OP/C015239','OP/C015240','OP/C015241','OP/C015242','OP/C015243','OP/C015245','OP/C015246','OP/C015248','OP/C015250','OP/C015251','OP/C015253','OP/C015254','OP/C015255','OP/C015257','OP/C015260','OP/C015263','OP/C015264','OP/C015265','OP/C015268','OP/C015269','OP/C015270','OP/C015271','OP/C015272','OP/C015273','OP/C015274','OP/C015275','OP/C015276','OP/C015277','OP/C015278','OP/C015279','OP/C015280','OP/C015281','OP/C015282','OP/C015283','OP/C015284','OP/C015285','OP/C015286','OP/C015287','OP/C015288','OP/C015289','OP/C015290','OP/C015291','OP/C015292','OP/C015293','OP/C015294','OP/C015295','OP/C015296','OP/C015297','OP/C015298','OP/C015299','OP/C015300','OP/C015303','OP/C015304','OP/C015305','OP/C015306','OP/C015307','OP/C015308','OP/C015309','OP/C015310','OP/C015311','OP/C015312','OP/C015313','OP/C015314','OP/C015315','OP/C015316','OP/C015317','OP/C015318','OP/C015319','OP/C015320','OP/C015321','OP/C015322','OP/C015323','OP/C015324','OP/C015325','OP/C015326','OP/C015327','OP/C015328','OP/C015329','OP/C015330','OP/C015331','OP/C015332','OP/C015333','OP/C015334','OP/C015335','OP/C015336','OP/C015337','OP/C015338','OP/C015340','OP/C015341','OP/C015342','OP/C015343','OP/C015344','OP/C015345','OP/C015346','OP/C015347','OP/C015348','OP/C015349','OP/C015350','OP/C015351','OP/C015352','OP/C015353','OP/C015354','OP/C015355','OP/C015356','OP/C015357','OP/C015358','OP/C015359','OP/C015360','OP/C015361','OP/C015362','OP/C015363','OP/C015364','OP/C015367','OP/C015368','OP/C015369','OP/C015370','OP/C015371','OP/C015372','OP/C015373','OP/C015374','OP/C015375','OP/C015376','OP/C015377','OP/C015378','OP/C015379','OP/C015380','OP/C015381','OP/C015382','OP/C015383','OP/C015384','OP/C015385','OP/C015386','OP/C015387','OP/C015388','OP/C015389','OP/C015390','OP/C015391','OP/C015392','OP/C015393','OP/C015394','OP/C015395','OP/C015396','OP/C015397','OP/C015398','OP/C015399','OP/C015400','OP/C015401','OP/C015402','OP/C015404','OP/C015405','OP/C015406','OP/C015407','OP/C015408','OP/C015410','OP/C015411','OP/C015412','OP/C015415','OP/C015416','OP/C015417','OP/C015419','OP/C015421','OP/C015422','OP/C015424','OP/C015425','OP/C015426','OP/C015428','OP/C015431','OP/C015432','OP/C015433','OP/C015434','OP/C015435','OP/C015436','OP/C015437','OP/C015438','OP/C015440','OP/C015441','OP/C015442','OP/C015443','OP/C015445','OP/C015446','OP/C015447','OP/C015448','OP/C015449','OP/C015450','OP/C015451','OP/C015452','OP/C015453','OP/C015454','OP/C015455','OP/C015457','OP/C015458','OP/C015459','OP/C015460','OP/C015461','OP/C015462','OP/C015463','OP/C015465','OP/C015466','OP/C015468','OP/C015469','OP/C015470','OP/C015471','OP/C015473','OP/C015474','OP/C015475','OP/C015476','OP/C015477','OP/C015478','OP/C015479','OP/C015480','OP/C015481','OP/C015482','OP/C015483','OP/C015484','OP/C015507','OP/C015508','OP/C015509','OP/C015511','OP/C015512','OP/C015513','OP/C015514','OP/C015515','OP/C015516','OP/C015517','OP/C015518','OP/C015519','OP/C015520','OP/C015522','OP/C015523','OP/C015525','OP/C015528','OP/C015529','OP/C015530','OP/C015531','OP/C015532','OP/C015533','OP/C015534','OP/C015535','OP/C015536','OP/C015537','OP/C015538','OP/C015540','OP/C015541','OP/C015542','OP/C015546','OP/C015548','OP/C015549','OP/C015550','OP/C015551','OP/C015553','OP/C015554','OP/C015555','OP/C015556','OP/C015557','OP/C015558','OP/C015559','OP/C015560','OP/C015561','OP/C015562','OP/C015563','OP/C015564','OP/C015565','OP/C015566','OP/C015567','OP/C015569','OP/C015570','OP/C015571','OP/C015572','OP/C015573','OP/C015574','OP/C015575','OP/C015576','OP/C015578','OP/C015579','OP/C015580','OP/C015581','OP/C015582','OP/C015584','OP/C015585','OP/C015586','OP/C015588','OP/C015589','OP/C015590','OP/C015591','OP/C015592','OP/C015593','OP/C015594','OP/C015595','OP/C015596','OP/C015598','OP/C015599','OP/C015600','OP/C015601','OP/C015602','OP/C015603','OP/C015604','OP/C015605','OP/C015606','OP/C015608','OP/C015609','OP/C015611','OP/C015612','OP/C015613','OP/C015614','OP/C015615','OP/C015617','OP/C015618','OP/C015619','OP/C015620','OP/C015621','OP/C015622','OP/C015623','OP/C015624','OP/C015625','OP/C015626','OP/C015629','OP/C015630','OP/C015631','OP/C015632','OP/C015633','OP/C015634','OP/C015635','OP/C015637','OP/C015638','OP/C015639','OP/C015640','OP/C015641','OP/C015642','OP/C015644','OP/C015645','OP/C015649','OP/C015650','OP/C015651','OP/C015652','OP/C015653','OP/C015654','OP/C015655','OP/C015657','OP/C015658','OP/C015659','OP/C015660','OP/C015661','OP/C015662','OP/C015663','OP/C015664','OP/C015666','OP/C015667','OP/C015668','OP/C015669','OP/C015671','OP/C015672','OP/C015673','OP/C015674','OP/C015676','OP/C015677','OP/C015678','OP/C015679','OP/C015680','OP/C015681','OP/C015683','OP/C015684','OP/C015685','OP/C015686','OP/C015687','OP/C015688','OP/C015689','OP/C015690','OP/C015691','OP/C015692','OP/C015693','OP/C015694','OP/C015695','OP/C015697','OP/C015698','OP/C015699','OP/C015700','OP/C015701','OP/C015702','OP/C015703','OP/C015705','OP/C015706','OP/C015708','OP/C015709','OP/C015710','OP/C015711','OP/C015712','OP/C015713','OP/C015714','OP/C015715','OP/C015716','OP/C015717','OP/C015718','OP/C015719','OP/C015720','OP/C015722','OP/C015723','OP/C015724','OP/C015725','OP/C015726','OP/C015727','OP/C015728','OP/C015729','OP/C015730','OP/C015731','OP/C015732','OP/C015733','OP/C015735','OP/C015736','OP/C015737','OP/C015738','OP/C015742','OP/C015743','OP/C015744','OP/C015745','OP/C015746','OP/C015747','OP/C015748','OP/C015749','OP/C015750','OP/C015751','OP/C015752','OP/C015753','OP/C015754','OP/C015755','OP/C015756','OP/C015758','OP/C015759','OP/C015764','OP/C015765','OP/C015767','OP/C015768','OP/C015769','OP/C015770','OP/C015771','OP/C015772','OP/C015773','OP/C015774','OP/C015775','OP/C015776','OP/C015777','OP/C015778','OP/C015779','OP/C015780','OP/C015781','OP/C015783','OP/C015784','OP/C015785','OP/C015786','OP/C015787','OP/C015788','OP/C015789','OP/C015790','OP/C015791','OP/C015792','OP/C015793','OP/C015794','OP/C015795','OP/C015796','OP/C015797','OP/C015798','OP/C015799','OP/C015801','OP/C015802','OP/C015803','OP/C015805','OP/C015806','OP/C015807','OP/C015808','OP/C015809','OP/C015810','OP/C015812','OP/C015813','OP/C015814','OP/C015815','OP/C015816','OP/C015818','OP/C015819','OP/C015820','OP/C015821','OP/C015822','OP/C015823','OP/C015824','OP/C015825','OP/C015827','OP/C015828','OP/C015830','OP/C015831','OP/C015832','OP/C015834','OP/C015835','OP/C015836','OP/C015838','OP/C015840','OP/C015841','OP/C015842','OP/C015843','OP/C015844','OP/C015845','OP/C015846','OP/C015847','OP/C015848','OP/C015849','OP/C015850','OP/C015851','OP/C015852','OP/C015853','OP/C015854','OP/C015855','OP/C015856','OP/C015857','OP/C015858','OP/C015859','OP/C015860','OP/C015861','OP/C015862','OP/C015863','OP/C015864','OP/C015865','OP/C015866','OP/C015867','OP/C015868','OP/C015869','OP/C015870','OP/C015871','OP/C015873','OP/C015874','OP/C015875','OP/C015876','OP/C015877','OP/C015878','OP/C015879','OP/C015880','OP/C015881','OP/C015882','OP/C015883','OP/C015884','OP/C015885','OP/C015886','OP/C015887','OP/C015888','OP/C015890','OP/C015891','OP/C015892','OP/C015893','OP/C015894','OP/C015895','OP/C015896','OP/C015897','OP/C015898','OP/C015899','OP/C015900','OP/C015901','OP/C015902','OP/C015904','OP/C015905','OP/C015906','OP/C015907','OP/C015908','OP/C015909','OP/C015910','OP/C015911','OP/C015912','OP/C015913','OP/C015914','OP/C015915','OP/C015916','OP/C015917','OP/C015918','OP/C015919','OP/C015920','OP/C015921','OP/C015922','OP/C015923','OP/C015924','OP/C015925','OP/C015926','OP/C015928','OP/C015929','OP/C015930','OP/C015931','OP/C015932','OP/C015933','OP/C015934','OP/C015935','OP/C015936','OP/C015937','OP/C015938','OP/C015939','OP/C015940','OP/C015941','OP/C015942','OP/C015943','OP/C015945','OP/C015946','OP/C015947','OP/C015948','OP/C015949','OP/C015950','OP/C015951','OP/C015952','OP/C015953','OP/C015954','OP/C015955','OP/C015956','OP/C015957','OP/C015958','OP/C015959','OP/C015961','OP/C015962','OP/C015963','OP/C015964','OP/C015965','OP/C015966','OP/C015967','OP/C015969','OP/C015970','OP/C015971','OP/C015972','OP/C015973','OP/C015974','OP/C015975','OP/C015976','OP/C015977','OP/C015978','OP/C015979','OP/C015980','OP/C015981','OP/C015982','OP/C015983','OP/C015984','OP/C015985','OP/C015986','OP/C015987','OP/C015988','OP/C015989','OP/C015990','OP/C015991','OP/C015992','OP/C015993','OP/C015994','OP/C015995','OP/C015996','OP/C015997','OP/C015998','OP/C015999','OP/C016000','OP/C016001','OP/C016002','OP/C016004','OP/C016005','OP/C016006','OP/C016007','OP/C016008','OP/C016009','OP/C016010','OP/C016011','OP/C016012','OP/C016013','OP/C016014','OP/C016015','OP/C016016','OP/C016017','OP/C016018','OP/C016019','OP/C016021','OP/C016022','OP/C016023','OP/C016024','OP/C016025','OP/C016026','OP/C016027','OP/C016028','OP/C016029','OP/C016030','OP/C016031','OP/C016032','OP/C016033','OP/C016035','OP/C016036','OP/C016037','OP/C016038','OP/C016039','OP/C016040','OP/C016041','OP/C016042','OP/C016043','OP/C016044','OP/C016045','OP/C016046','OP/C016047','OP/C016048','OP/C016049','OP/C016050','OP/C016051','OP/C016052','OP/C016053','OP/C016054','OP/C016055','OP/C016056','OP/C016057','OP/C016059','OP/C016060','OP/C016061','OP/C016062','OP/C016063','OP/C016064','OP/C016065','OP/C016066','OP/C016067','OP/C016068','OP/C016069','OP/C016070','OP/C016071','OP/C016072','OP/C016073','OP/C016074','OP/C016076','OP/C016077','OP/C016078','OP/C016079','OP/C016080','OP/C016081','OP/C016082','OP/C016083','OP/C016084','OP/C016085','OP/C016086','OP/C016087','OP/C016088','OP/C016089','OP/C016090','OP/C016092','OP/C016093','OP/C016094','OP/C016095','OP/C016096','OP/C016097','OP/C016098','OP/C016100','OP/C016101','OP/C016102','OP/C016103','OP/C016104','OP/C016105','OP/C016106','OP/C016107','OP/C016108','OP/C016109','OP/C016110','OP/C016111','OP/C016112','OP/C016113','OP/C016114','OP/C016115','OP/C016116','OP/C016117','OP/C016118','OP/C016119','OP/C016120','OP/C016121','OP/C016122','OP/C016123','OP/C016124','OP/C016125','OP/C016126','OP/C016127','OP/C016128','OP/C016129','OP/C016130','OP/C016131','OP/C016132','OP/C016133','OP/C016135','OP/C016136','OP/C016137','OP/C016138','OP/C016139','OP/C016140','OP/C016141','OP/C016142','OP/C016143','OP/C016144','OP/C016145','OP/C016146','OP/C016147','OP/C016148','OP/C016149','OP/C016150','OP/C016152','OP/C016153','OP/C016154','OP/C016155','OP/C016156','OP/C016157','OP/C016158','OP/C016159','OP/C016160','OP/C016161','OP/C016162','OP/C016163','OP/C016164','OP/C016166','OP/C016167','OP/C016168','OP/C016169','OP/C016170','OP/C016171','OP/C016172','OP/C016173','OP/C016174','OP/C016175','OP/C016176','OP/C016177','OP/C016178','OP/C016179','OP/C016180','OP/C016181','OP/C016182','OP/C016183','OP/C016184','OP/C016185','OP/C016186','OP/C016187','OP/C016188','OP/C016190','OP/C016191','OP/C016192','OP/C016193','OP/C016194','OP/C016195','OP/C016196','OP/C016197','OP/C016198','OP/C016199','OP/C016200','OP/C016201','OP/C016202','OP/C016203','OP/C016204','OP/C016205','OP/C016207','OP/C016208','OP/C016209','OP/C016210','OP/C016211','OP/C016212','OP/C016213','OP/C016214','OP/C016215','OP/C016216','OP/C016217','OP/C016218','OP/C016219','OP/C016220','OP/C016221','OP/C016223','OP/C016224','OP/C016225','OP/C016226','OP/C016227','OP/C016228','OP/C016229','OP/C016231','OP/C016232','OP/C016233','OP/C016234','OP/C016235','OP/C016236','OP/C016237','OP/C016238','OP/C016239','OP/C016240','OP/C016241','OP/C016242','OP/C016243','OP/C016244','OP/C016245','OP/C016246','OP/C016247','OP/C016248','OP/C016249','OP/C016250','OP/C016251','OP/C016252','OP/C016253','OP/C016254','OP/C016255','OP/C016256','OP/C016257','OP/C016258','OP/C016259','OP/C016260','OP/C016261','OP/C016262','OP/C016263','OP/C016264','OP/C016266','OP/C016267','OP/C016268','OP/C016269','OP/C016270','OP/C016271','OP/C016272','OP/C016273','OP/C016274','OP/C016275','OP/C016276','OP/C016277','OP/C016278','OP/C016279','OP/C016280','OP/C016281','OP/C016283','OP/C016284','OP/C016285','OP/C016286','OP/C016287','OP/C016288','OP/C016289','OP/C016290','OP/C016291','OP/C016292','OP/C016293','OP/C016294','OP/C016295','OP/C016297','OP/C016298','OP/C016299','OP/C016300','OP/C016301','OP/C016302','OP/C016303','OP/C016304','OP/C016305','OP/C016306','OP/C016307','OP/C016308','OP/C016309','OP/C016310','OP/C016311','OP/C016312','OP/C016313','OP/C016314','OP/C016315','OP/C016316','OP/C016317','OP/C016318','OP/C016319','OP/C016321','OP/C016322','OP/C016323','OP/C016324','OP/C016325','OP/C016326','OP/C016327','OP/C016328','OP/C016329','OP/C016330','OP/C016331','OP/C016332','OP/C016333','OP/C016334','OP/C016335','OP/C016336','OP/C016338','OP/C016339','OP/C016340','OP/C016341','OP/C016342','OP/C016343','OP/C016344','OP/C016345','OP/C016346','OP/C016347','OP/C016348','OP/C016349','OP/C016350','OP/C016351','OP/C016352','OP/C016354','OP/C016355','OP/C016356','OP/C016357','OP/C016358','OP/C016359','OP/C016360','OP/C016362','OP/C016363','OP/C016364','OP/C016365','OP/C016366','OP/C016367','OP/C016368','OP/C016369','OP/C016370','OP/C016371','OP/C016372','OP/C016373','OP/C016374','OP/C016375','OP/C016376','OP/C016377','OP/C016378','OP/C016379','OP/C016380','OP/C016381','OP/C016382','OP/C016383','OP/C016384','OP/C016385','OP/C016386','OP/C016387','OP/C016388','OP/C016389','OP/C016390','OP/C016391','OP/C016392','OP/C016393','OP/C016394','OP/C016395','OP/C016397','OP/C016398','OP/C016399','OP/C016400','OP/C016401','OP/C016402','OP/C016403','OP/C016404','OP/C016405','OP/C016406','OP/C016407','OP/C016408','OP/C016409','OP/C016410','OP/C016411','OP/C016412','OP/C016414','OP/C016415','OP/C016416','OP/C016417','OP/C016418','OP/C016419','OP/C016420','OP/C016421','OP/C016422','OP/C016423','OP/C016424','OP/C016425','OP/C016426','OP/C016428','OP/C016429','OP/C016430','OP/C016431','OP/C016432','OP/C016433','OP/C016434','OP/C016435','OP/C016436','OP/C016437','OP/C016438','OP/C016439','OP/C016440','OP/C016441','OP/C016442','OP/C016443','OP/C016444','OP/C016445','OP/C016446','OP/C016447','OP/C016448','OP/C016449','OP/C016450','OP/C016452','OP/C016453','OP/C016454','OP/C016455','OP/C016456','OP/C016457','OP/C016458','OP/C016459','OP/C016460','OP/C016461','OP/C016462','OP/C016463','OP/C016464','OP/C016465','OP/C016466','OP/C016467','OP/C016469','OP/C016470','OP/C016471','OP/C016472','OP/C016473','OP/C016474','OP/C016475','OP/C016476','OP/C016477','OP/C016478','OP/C016479','OP/C016480','OP/C016481','OP/C016482','OP/C016483','OP/C016485','OP/C016486','OP/C016487','OP/C016488','OP/C016489','OP/C016490','OP/C016491','OP/C016493','OP/C016494','OP/C016495','OP/C016496','OP/C016497','OP/C016498','OP/C016499','OP/C016500','OP/C016501','OP/C016502','OP/C016503','OP/C016504','OP/C016505','OP/C016506','OP/C016507','OP/C016508','OP/C016509','OP/C016510','OP/C016511','OP/C016512','OP/C016513','OP/C016514','OP/C016515','OP/C016516','OP/C016517','OP/I050149','OP/I050160','OP/I050168','OP/I050175','OP/I050176','OP/I050238','OP/I050269','OP/I050284','OP/I050288','OP/I050291','OP/I050297','OP/I050298','OP/I050299','OP/I050305','OP/I050306','OP/I050309','OP/I050350','OP/I050384','OP/I050386','OP/I050398','OP/I050410','OP/I050413','OP/I050427','OP/I050429','OP/I050431','OP/I050502','OP/I050503','OP/I050506','OP/I050512','OP/I050513','OP/I050529','OP/I050551','OP/I050554','OP/I050556','OP/I050566')
	AND			h.order_no	LIKE '%SB%'
	AND			d.product NOT LIKE 'GENDIS%'
	GROUP BY	LTRIM(RTRIM(d.product)), RIGHT(LTRIM(RTRIM(h.customer)),2) 
	ORDER BY	RIGHT(LTRIM(RTRIM(h.customer)),2)


SELECT	*
FROM		#StockAdjusts
	-- SO number reset to = 16610

--UPDATE 	VapeConnectTest.dbo.SYSSettings SET KeyValue = @NextCNNumber  WHERE KeyRef = 'IMPNXBRCNNUM'

--DROP TABLE #CreditNotes 
--DROP TABLE #StockAdjusts
